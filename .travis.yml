language: php

php:
  - 5.4

mysql:
  database: drupal
  username: root
  encoding: utf8

env:
  - UPGRADE=none

matrix:
  fast_finish: true
  allow_failures:
    - env: UPGRADE=none

install:
  - sudo mkdir -p /var/www
  - cd /var/www
  - sudo mkdir elmsln
  - sudo chown root:root elmsln
  - sudo git clone https://github.com/btopro/elmsln.git
  - cd /var/www/elmsln
  - sudo rm -rf config
  - sudo git clone https://github.com/btopro/elmsln-config-vagrant.git config

  - sudo pear upgrade --force Console_Getopt
  - sudo pear upgrade --force pear
  - sudo pear upgrade-all
  - sudo pear channel-discover pear.drush.org
  - sudo pear install drush/drush
  - sudo mkdir ~/.drush/
  - sudo cp -r /var/www/elmsln/scripts/drush/server/* ~/.drush/
  - sudo chown -R root:root .drush

  - sudo apachectl -k restart

  - sudo ln -s /var/www/elmsln elmsln

#before_script:
#  - $HOME/travis-ci.sh before-tests

script:
  - sudo bash /var/www/elmsln/scripts/install/elmsln-install.sh

after_script:
  - drush @online uli

notifications:
  slack:
    rooms:
      - elmsln:WmKTRMe7k3IjprunaAVV3Jjg#general
      - elmsln:WmKTRMe7k3IjprunaAVV3Jjg#qa
      - elmsln:WmKTRMe7k3IjprunaAVV3Jjg#code
