<?php
/**
 * @file
 * Code for the CLE API.
 */

/**
 * Implements hook_menu().
 */
function cle_api_menu() {
  $items = array();

  $items['api/v1/cle'] = array(
    'page callback' => '_cle_api_v1_cle',
    'access callback' => 'user_is_logged_in',
    'type' => MENU_CALLBACK,
  );

  return $items;
}

/**
 * Callback to return the possible API endpoints.
 * @return json
 */
function _cle_api_v1_cle() {
  $apipaths = $vars = array();
  // discover other parts of the API
  $router = array_keys(menu_get_router());
  // search the router for matches against our API base
  foreach ($router as $item) {
    if (strpos($item, 'api/v1/cle') !== FALSE) {
      $tmp = explode('/', $item);
      $callkey = array_pop($tmp);
      if ($callkey == 'cle') {
        $callkey = 'self';
      }
      $vars['links'][$callkey] = $GLOBALS['base_url'] . '/' . $item;
    }
  }
  // output the assginments
  drupal_add_http_header('Content-Type', 'application/json');
  print drupal_json_output($vars);
  drupal_exit();
}

/**
 * Helper function to randomly choose from an array. For development purposes
 * only.
 */
function _cle_api_random($array, $amount = 1) {
  $index = array_rand($array, $amount);

  if (is_array($index)) {
    $a = array();
    foreach($index as $i) {
      $a[] = $array[$i];
    }
    return $a;
  }
  else {
    return $array[$index];
  }
}
