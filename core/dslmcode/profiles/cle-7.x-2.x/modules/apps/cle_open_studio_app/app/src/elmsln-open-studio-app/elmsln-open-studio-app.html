<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/lrndesign-drawer/lrndesign-drawer.html">
<link rel="import" href="../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/iron-icons/hardware-icons.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../bower_components/paper-styles/color.html">
<link rel="import" href="../../bower_components/paper-styles/typography.html">
<link rel="import" href="../../bower_components/materializecss-styles/materializecss-styles.html">
<link rel="import" href="../../bower_components/lrndesign-gallerycard/lrndesign-gallerycard.html">

<dom-module id="elmsln-open-studio-app">
  <template>
    <style include="materializecss-styles"></style>
    <style>
      :host {
        display: block;
        height: 100vh;
        display: flex;
        flex-direction: column;
      }
      iron-list {
        flex: 1 1 auto;
      }
      paper-button {
        height: 2em;
      }
    </style>
    <iron-ajax auto
      url="[[source-path]]"
      params=''
      handle-as="json"
      on-response="responseCleanup"
      last-response="{{submissionsResponse}}"></iron-ajax>
    <iron-list grid items="{{submissions}}" as="submission">
      <template>
      <lrndesign-gallerycard title="{{submission.data.title}}" text="{{submission.data.field_submission_text.und.0.safe_value}}" url="{{submission.data.url}}" author="{{submission.data.name}}" comments="{{submission.data.comment_count}}">
      </lrndesign-gallerycard>
      </template>
    </iron-list>
  </template>

  <script>
    Polymer({

      is: 'elmsln-open-studio-app',

      properties: {
        submissions: {
          type: Array
        },
        submissionsResponse: {
          type: Object
        },
        titleFilter: {
          type: String,
          value: '',
          reflectToAttribute: true,
          notify: true,
        }
      },
      responseCleanup: function(e) {
        var arrayIt = this._toArray(this.submissionsResponse.data);
        console.log(arrayIt);
        this.submissions = arrayIt;
        console.log(this.submissions);
      },

      _toArray: function(obj) {
        return Object.keys(obj).map(function(key) {
          return {
              key: key,
              data: obj[key]
          };
        });
      },
    });
  </script>
</dom-module>
