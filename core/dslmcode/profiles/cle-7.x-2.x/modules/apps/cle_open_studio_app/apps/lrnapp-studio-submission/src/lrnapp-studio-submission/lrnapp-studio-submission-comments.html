<dom-module id="lrnapp-studio-submission-comments">
  <template>
    <style>
       :host {
        display: block;
      }
    </style>
    <template is="dom-if" if="[[submission.relationships.comments]]">
      <template is="dom-repeat" items="[[_toArray(submission.relationships.comments.data)]]" as="comment">
        <lrnapp-studio-submission-comment comment="{{comment}}"></lrnapp-studio-submission-comment>
      </template>
    </template>
  </template>
  <script>
    Polymer({
      is: 'lrnapp-studio-submission-comments',
      properties: {
        submission: {
          type: Object
        },
      },
      /**
       * Simple way to convert from object to array.
       */
      _toArray: function (obj) {
        return Object.keys(obj).map(function (key) {
          return obj[key];
        });
      }
    });
  </script>
</dom-module>


<dom-module id="lrnapp-studio-submission-comment">
  <template>
    <style>
       :host {
        display: block;
      }

      paper-card {
        padding: .5em;
      }

      h1, h2, h3, h4 {
        text-align: left;
      }

      .nowrap {
        width: 90%;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

    </style>
    <div class="container">
    <div class$="card-content comment-depth-[[comment.attributes.threadDepth]]">
      <div class="container-flex">
        <div class="center">
          <lrndesign-avatar label="[[comment.relationships.author.data.name]]" class="float-left"></lrndesign-avatar>
          <!--<p class="date">{{comment.meta.created}}</p>-->
          <p class="date">07/09/17</p>
        </div>
        <paper-card class="nowrap">
          <div class="comment-body">
            <h4>{{comment.relationships.author.data.name}} <span class="grey-said"> said:</span></h4>
            <p class="inactive">{{comment.attributes.body}}</p>
          </div>
          <div class="card-actions">
            <paper-icon-button id="reply" icon="icons:reply"></paper-icon-button>
            <paper-tooltip for="reply" animation-delay="0">Reply</paper-tooltip>
            <paper-icon-button class="right-actions hidden" id="edit" icon="icons:create"></paper-icon-button>
            <paper-tooltip for="edit" animation-delay="0">Edit</paper-tooltip>
            <paper-icon-button class="right-actions hidden" id="delete" icon="icons:delete-forever"></paper-icon-button>
            <paper-tooltip for="delete" animation-delay="0">Delete</paper-tooltip>
          </div>
        </paper-card>
      </div>
    </div>
</div>
  </template>
  <script>
    Polymer({
      is: 'lrnapp-studio-submission-comment',
      properties: {
        comment: {
          type: Object
        }
      },
      ready: function () {
        var root = this;
        var comment = root.$$('paper-card');
        comment.addEventListener('click', function (e) {
          // var normalizedEvent = Polymer.dom(e);
          // console.info('localTarget is:', normalizedEvent.localTarget);
          var target = e.target
          if (target) {
            comment.classList.toggle('nowrap');
          }
        });


      }
    });
  </script>
</dom-module>