<!--
`lrndesign-gallerycard`
A LRN element for presenting a gallery of items as cards
that can pop up to display more info
@demo demo/index.html
-->

<dom-module id="lrndesign-gallerycard">
  <template>
    <google-webfont-loader fonts="Droid Sans,Droid Serif:700i,Anonymous Pro:700"></google-webfont-loader>
    <style>
       :host {
        display: inline-flex;
        width: 24%;
      }

      lrn-icon {
        margin: 0 .5em;
      }

      paper-card {
        border-radius: 4px;
        margin: 0.75rem;
        width: 16rem;
      }

      .card-actions {
        background-color: #f5f5f5;
        border-radius: 0 0 4px 4px;
      }

      .card-control-height {
        height: 15rem;
      }

      [elevation="0"] {
        border: solid 1px #EEEEEE;
      }

      .text-right {
        text-align: right;
      }

      .text-center {
        text-align: center;
      }

      .text-left {
        text-align: left;
      }

      h1, h2, h3, h4 {
        font-family: 'Open Sans', sans-serif;
        margin: 0;
        text-align: left;
      }

      .title {
        color: #222;
        font-size: 1.25rem;
        font-weight: 600;
        line-height: 1.25rem;
        padding: 0.25rem 0;
        overflow-x: hidden;
        text-overflow: ellipsis;
        margin-top: 1rem;
      }

      .student {
        color: #555;
        font-size: 1rem;
        font-weight: 500;
        line-height: 1rem;
        padding: 0.25rem 0 0.5rem 0;
        text-transform: capitalize;
      }

      .comments {
        color: #444;
        font-size: .75rem;
        font-weight: 400;
        line-height: .75rem;
        padding: 0.25rem 0 0.5rem 0;
      }

      .assignment {
        color: #222;
        font-size: 1.5rem;
        font-weight: 600;
        line-height: 1.25rem;
        padding: 0.5rem 0 0.5rem 0;
        width: 100%;
      }

      h4 {
        color: #444;
        font-size: 1rem;
        font-weight: 500;
        line-height: 1rem;
        padding: 0.5rem 0 0.5rem 0;
        text-align: center;
      }

      .divider {
        height: 1px;
        width: 100%;
        background: #efefef;
      }

      .header {
        background: #efefef;
        padding-bottom: 1rem;
      }

      .icon-submission {
        color: #888;
      }

      .icon-submission:hover {
        color: #000;
      }

      .big {
        --iron-icon-height: 100%;
        --iron-icon-width: 100%;
      }

     .avatar {
        padding-top: 2rem;
      }
      
      /* Custom Tags */
      lrnsys-dialog {
        width: 100%;
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      lrnsys-dialog p {
        width: 80%;
        margin: 1em auto 1em auto;
        text-align: left;
      }

      lrnsys-dialog .comments {
        float: right;
        margin: 0 4em 2em 0;
      }

      lrnsys-dialog .head {
        width: 100%;
        margin: auto;
        text-align: center;
      }

      lrnsys-dialog .head h3 {
        color: var(--paper-grey-600);
      }

      lrnsys-dialog.lrndesign-gallerycard p.lrndesign-gallerycard {
        margin: 0;
        text-align: left;
        width: 100%;
      }


      .contain {
        width: 10em;
        height: 10em;
        background: #efefef;
        display: inline;
      }

      .center {
        margin: auto;
        width: 80%;
        padding: 1em;
      }

      .link {
        font-size: 1em;
        line-height: 1em;
      }

      .submission-info {
        position: absolute;
        bottom: 0;
      }

      .card-content {
        max-height: 8em;
        overflow: hidden;
      }

      .image-set-submission {
        display: inline-flex;
        flex-flow: row wrap;
        align-content: flex-start;
        height: 4rem;
      }

      .image-quad {
          --iron-image-height: auto;
          --iron-image-width: 100%;
          flex-basis:100%;
        }

      .inline {
        display: inline;
      }

      ul {
        text-align: left;
        margin-left: 5em;
      }

    </style>
    <paper-card elevation="[[elevation]]">
      <lrnsys-dialog id="dialog">
        <div slot="button" class="card-control-height card-control-center">
          <div class="card-content">
            <!-- ----- Images Submission -----  -->
            <template is="dom-if" if="{{_previewType(images)}}">
              <template is="dom-repeat" items="[[_toArray(images)]]" as="image">
                <div class="image-set-submission">
                  <iron-image class="image-quad" src="[[image]]"></iron-image>
                </div>
              </template>
            </template>
            <!-- ----- Videos Submission -----  -->
            <template is="dom-if" if="{{_previewType(videos)}}">
              <div class="icon-submission">
                <iron-icon class="big" icon="av:video-library">
                  </iron-icon>
              </div>
            </template>
            <!-- ----- Files Submission -----  -->
            <template is="dom-if" if="{{_previewType(files)}}">
              <div class="icon-submission">
                <iron-icon class="big" icon="icons:file-download">
                  </iron-icon>
              </div>
            </template>
            <!-- ----- Link Submission -----  -->
            <template is="dom-if" if="{{_previewType(links)}}">
              <div class="icon-submission">
                <iron-icon class="big" icon="icons:link">
                  </iron-icon>
              </div>
            </template>
            <!-- ----- Text Submission -----  -->
            <template is="dom-if" if="{{_previewType(text)}}">
              <p class="icon-submission">
               <iron-icon class="big" icon="icons:subject">
                  </iron-icon>
              </p>
            </template>
          </div>

          <div class="submission-info">
            <div class=divider></div>
            <h1 class="title">[[title]]</h1>
            <h2 class="student">[[author]]</h2>
          </div>

        </div>
        <div class="header" slot="header">
          <div class="head text-center">
            <lrndesign-avatar class="avatar" label="{{author}}"></lrndesign-avatar>
            <h1 class="student text-center">{{author}}</h1>
            <!-- Need to pull the projectTitle -->
            <h2 class="title text-center">Project Title</h2>
          </div>
        </div>
        <!-- slot for content of the modal -->
        <span slot="content">
          <h3 class="assignment text-center">{{title}}</h3>
          <!-- ----- Images Submission -----  -->
          <template is="dom-if" if="{{images}}">
            <div class="center">
              <h4>Images Submitted</h4>
              <template is="dom-repeat" items="[[_toArray(images)]]">
                <lrnsys-dialog class="inline-dialog-trigger inline">
                  <iron-image slot="button" sizing="contain" class="contain" src="[[item]]"></iron-image>
                  <iron-image src="[[item]]"></iron-image>
                </lrnsys-dialog>
              </template>
            </div>
          </template>
          <!-- ----- Videos Submission -----  -->
          <template is="dom-if" if="{{videos}}">
            <div class="center">
              <h4>Videos Submitted</h4>
              <template is="dom-repeat" items="[[_toArray(videos)]]">
                <iframe src="[[item]]"></iframe>
              </template>
            </div>
          </template>
          <!-- ----- Text Submission -----  -->
          <template is="dom-if" if="{{text}}">
            <p>{{text}}</p>
          </template>
          <!-- ----- Links Submission -----  -->
          <template is="dom-if" if="{{links}}">
            <div class="center">
              <h4 class="text-left">Links Submitted</h4>
              <ul>
              <template is="dom-repeat" items="[[_toArray(links)]]">
                <li>
                <a class="link" href="[[item]]"><lrn-icon icon="online"></lrn-icon>[[item]]</a>
                </li>
              </template>
              </ul>
            </div>
          </template>
          <!-- ----- Files Submission -----  -->
          <template is="dom-if" if="{{files}}">
            <div class="center">
              <h4 class="text-left">Files Submitted</h4>
              <ul>
              <template is="dom-repeat" items="[[_toArray(files)]]">
                <li>
                <a class="link" href="[[item]]" target="_blank">[[item]]</a>
                </li>
              </template>
              </ul>
            </div>
          </template>
          <a href="{{url}}" tabindex="-1"><span class="comments">[[comments]]<lrn-icon icon="comment"></lrn-icon></span></a>
        <hr class="divider">
        </span>
      </lrnsys-dialog>
      <div class="card-actions">
        <h3 class="comments text-right">Comments: [[comments]]</h3>
      </div>
    </paper-card>
    <iron-ajax params="{}" id="ajaxRequest" url="{{url}}" handle-as="json" on-response="_handleReturnedData"></iron-ajax>
  </template>
  <script>
    Polymer({
      is: 'lrndesign-gallerycard',
      listeners: {
        'mouseenter': '_mouseEnter',
        'mouseleave': '_mouseLeave',
      },
      properties: {
        /**
         * Array of src to images.
         */
        images: {
          type: Object,
          reflectToAttribute: true,
          notify: true,
        },
        /**
         * Text from the submission
         */
        files: {
          type: Object,
          reflectToAttribute: true,
          notify: true,
        },
        /**
         * Text from the submission
         */
        text: {
          type: String,
          reflectToAttribute: true,
          notify: true,
        },
        /**
         * Links from the submission
         */
        links: {
          type: Object,
          reflectToAttribute: true,
          notify: true,
        },
        /**
         * Videos from the submission
         */
        videos: {
          type: Object,
          reflectToAttribute: true,
          notify: true,
        },
        /**
         * Title of the gallery item
         */
        title: {
          type: String,
          value: 'Project',
          reflectToAttribute: true,
          notify: true,
        },
        /**
         * Gallery creator
         */
        author: {
          type: String,
          value: 'Author',
          reflectToAttribute: true,
          notify: true,
        },
        /**
         * Visual elevation of the item off the UI via paper element height
         */
        elevation: {
          type: Number,
          value: 0,
          reflectToAttribute: true,
          notify: true,
        },
        /**
         * URL to the gallery itself
         */
        url: {
          type: String,
          reflectToAttribute: true,
          notify: true,
        },
        /**
         * Number of comments this has
         */
        comments: {
          type: Number,
          value: 0,
          reflectToAttribute: true,
          notify: true,
        },
        /**
         * Found, internal
         */
        foundTypeMatch: {
          type: Boolean,
          value: false,
        },
        /**
         * Property to hold data returned from an endpoint
         */
        itemResponse: {
          type: Object,
        }
      },
      /**
       * whatever is in the 'data' element rip it into
       * the innerHTML of the response.
       */
      _handleReturnedData: function (e) {
        this.itemResponse = event.detail.response.data;
      },
      _mouseEnter: function (e) {
        this.elevation += 1;
      },
      _mouseLeave: function (e) {
        this.elevation -= 1;
      },
      ready: function () {
        let root = this;
        root.$$('#dialog').addEventListener('click', function (e) {
          let root = this;
          // support remote url loading
          if (typeof this.url !== "undefined") {
            root.$$('#ajaxRequest').generateRequest();
          }
        });
      },
      _toArray: function (obj) {
        return Object.keys(obj).map(function (key) {
          return obj[key];
        });
      },
      /**
       * Figure out what type of preview case to match for rendering
       * @param  mixed the item we are testing for to have a value of any kind
       * @return boolean     If it is populated or not
       */
      _previewType: function (data) {
        // make sure that if we already match a case we don't keep going
        if (this.foundTypeMatch) {
          return false;
        }
        // if the item is defined then we should load that part of the template
        if (typeof data !== 'undefined') {
          this.foundTypeMatch = true;
          return true;
        }
        return false;
      }
    });
  </script>
</dom-module>