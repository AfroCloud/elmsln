<dom-module id="lrnapp-studio-submission-page">
  <template>
    <style>
       :host {
        display: block;
      }

      .contain {
        width: 10em;
        height: 10em;
        background: #ddd;
      }

      .center {
        margin: auto;
        width: 80%;
        padding: 1em;
      }

      .submission {
        margin-bottom: 1em;
      }
    </style>

    <iron-ajax auto url="[[reqUrl]]" method="GET" body="[[reqBody]]" params="[[reqParams]]" content-type="application/json" handle-as="json"
      on-response="_handleResponse"></iron-ajax>
    <!-- ----- Title Submission -----  -->
    <template is="dom-if" if="[[submission]]">
      <h2>{{submission.attributes.title}}</h2>
    </template>
    <!-- ----- Images Submission -----  -->
    <template is="dom-if" if="[[submission.attributes.images]]">
      <div class="center submisson">
        <h4>Images Submitted</h4>
        <template is="dom-repeat" items="[[_toArray(submission.attributes.images)]]" as="image">
          <iron-image sizing="contain" class="contain" src="[[image.image_styles.elmsln_small]]"></iron-image>
        </template>
      </div>
    </template>
    <!-- ----- Video Submission -----  -->
    <template is="dom-if" if="[[submission.attributes.video]]">
      <div class="center submission">
        <h4>Videos Submitted</h4>
        <template is="dom-repeat" items="[[_toArray(submission.attributes.video)]]" as="video">
          <iframe src="[[video.video_url]]"></iframe>
        </template>
      </div>
    </template>
    <!-- ----- Text Submission -----  -->
    <template is="dom-if" if="[[submission.attributes.body]]">
      <div class="submission">
        <p>{{submission.attributes.body}}</p>
      </div>
    </template>
    <!-- ----- Links Submission -----  -->
    <template is="dom-if" if="[[submission.attributes.links]]">
      <div class="submission">
        <h4>Links Submitted</h4>
        <template is="dom-repeat" items="[[_toArray(submission.attributes.links)]]" as="link">
          [[link.title]]:
          <a class="link" href="[[link.url]]">[[link.url]]</a>
        </template>
      </div>
    </template>
    <!-- ----- Files Submission -----  -->
    <template is="dom-if" if="[[submission.attributes.files]]">
      <div class="submission">
        <h4>Files Submitted</h4>
        <template is="dom-repeat" items="[[_toArray(submission.attributes.files)]]" as="file">
          [[file.filename]]:
          <a class="link" href="[[file.url]]" target="_blank">[[file.url]]</a>
        </template>
      </div>
    </template>
  </template>
  <script>
    Polymer({
      is: 'lrnapp-studio-submission-page',
      properties: {
        reqUrl: {
          type: String
        },
        reqParams: {
          type: Object
        },
        reqBody: {
          type: Object
        },
        submission: {
          type: Object
        }
      },
      observers: [
        '_urlVarsChanged(id, endPoint)',
        '_paramsChanged(csrfToken)',
        '_bodyChanged(title)'
      ],
      _urlVarsChanged: function (id, endPoint) {
        this.reqUrl = endPoint + '/api/submissions';
      },
      _paramsChanged: function (csrfToken) {
        var params = this.reqParams || {};
        params.token = csrfToken;
        this.reqParams = params;
      },
      _handleResponse: function (data) {
        this.submission = data.detail.response.data[this.id];
        console.log(this.submission);
      },
      /**
       * Simple way to convert from object to array.
       */
      _toArray: function (obj) {
        return Object.keys(obj).map(function (key) {
          return obj[key];
        });
      },
    });
  </script>
</dom-module>