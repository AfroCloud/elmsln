<dom-module id="lrnapp-studio-submission-page">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <iron-ajax
       auto
       url="[[reqUrl]]"
       method="GET"
       body="[[reqBody]]"
       params="[[reqParams]]"
       content-type="application/json"
       handle-as="json"
       on-response="_handleResponse"></iron-ajax>

       <template is="dom-if" if="[[submission]]">
        {{submission.attributes.title}}
        {{submission.attributes.body}}
       </template>

  </template>
  <script>
    Polymer({
      is: 'lrnapp-studio-submission-page',
      properties: {
        reqUrl: {
          type: String
        },
        reqParams: {
          type: Object
        },
        reqBody: {
          type: Object
        },
        submission: {
          type: Object
        }
      },
      observers: [
        '_urlVarsChanged(id, endPoint)',
        '_paramsChanged(csrfToken)',
        '_bodyChanged(title)'
      ],
      _urlVarsChanged: function(id, endPoint) {
        this.reqUrl = endPoint + '/api/submissions';
      },
      _paramsChanged: function(csrfToken) {
        var params = this.reqParams || {};
        params.token = csrfToken;
        this.reqParams = params;
      },
      _handleResponse: function(data) {
        this.submission = data.detail.response.data[this.id];
        console.log(this.submission);
      }
    });
  </script>
</dom-module>