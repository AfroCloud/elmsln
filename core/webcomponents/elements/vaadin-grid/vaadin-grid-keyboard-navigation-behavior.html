<html><head><link rel="import" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html"><link rel="import" href="../iron-a11y-announcer/iron-a11y-announcer.html"><link rel="prefetch" href="../polymer/polymer.html"><link rel="prefetch" href="../polymer/polymer-mini.html"><link rel="prefetch" href="../polymer/polymer-micro.html"></head><body><dom-module id="vaadin-grid-navigation-themability-styles"><template><style>:host(:focus),
      #table:focus{outline:none;}:host([navigating]:not([interacting])) [focused] > .vaadin-grid-row[focused] > [focused] ::slotted(vaadin-grid-cell-content){box-shadow:inset 0 0 0 3px rgba(0, 0, 0, 0.3);@apply (--vaadin-grid-focused-cell);}</style></template></dom-module><script>window.vaadin=window.vaadin||{};vaadin.elements=vaadin.elements||{};vaadin.elements.grid=vaadin.elements.grid||{};vaadin.elements.grid.TableKeyboardBehaviorImpl={hostAttributes:{role:"application",tabindex:0},keyBindings:{"ctrl+home":"_onCtrlHome","ctrl+end":"_onCtrlEnd",down:"_onArrowDown",end:"_onEnd",enter:"_onEnter",esc:"_onEscape",f2:"_onF2",home:"_onHome",left:"_onArrowLeft",pagedown:"_onPageDown",pageup:"_onPageUp",right:"_onArrowRight",space:"_onSpace",tab:"_onTab",up:"_onArrowUp"},attached:function attached(){Polymer.IronA11yAnnouncer.requestAvailability()},properties:{_virtualFocus:{type:Object,observer:"_virtualFocusChanged"},interacting:{type:Boolean,reflectToAttribute:!0,value:!1},navigating:{type:Boolean,reflectToAttribute:!0,value:!1}},listeners:{focus:"_onFocus","cell-focus":"_onCellFocus","cell-content-focus":"_onCellContentFocus"},ready:function ready(){document.addEventListener("keydown",function(e){if(9===e.keyCode){this._tabbed=!0}if(9===e.keyCode&&e.shiftKey){this._shiftTabbed=!0}}.bind(this),!0);document.addEventListener("keyup",function(e){if(9===e.keyCode){this._tabbed=!1}if(9===e.keyCode&&e.shiftKey){this._shiftTabbed=!1}}.bind(this),!0)},_isFooterVisible:function _isFooterVisible(){return 0<this.$.footer._rows.filter(function(row){return!row.hidden}).length},_onFocus:function _onFocus(){if(this._tabbed&&!this._shiftTabbed){this._activateNavigation()}},_activateNavigation:function _activateNavigation(){this.$.footerFocusTrap.focus()},_onFocusout:function _onFocusout(){this.navigating=!1;this.interacting=!1},_onFooterFocus:function _onFooterFocus(){this.navigating=!0;this.interacting=!1;this._virtualFocus=this._virtualFocus||(this._shiftTabbed?this._isFooterVisible()?this.$.footer:this.$.items:this.$.header)},_virtualFocusChanged:function _virtualFocusChanged(virtualFocus,oldVirtualFocus){if(oldVirtualFocus){oldVirtualFocus.focused=!1}if(virtualFocus){virtualFocus._focusedCellIndex=virtualFocus._focusedCellIndex||0;virtualFocus._focusedRowIndex=virtualFocus._focusedRowIndex||0;virtualFocus.focused=!0;if(virtualFocus===this.$.items){this._ensureVirtualFocusInViewport()}}},_onTab:function _onTab(e){if(this.interacting||!this._virtualFocus){return}if(this.navigating){if(e.detail.keyboardEvent.shiftKey){switch(this._virtualFocus){case this.$.footer:this._virtualFocus=this.$.items;e.preventDefault();break;case this.$.items:this._virtualFocus=this.$.header;e.preventDefault();break;case this.$.header:this.focus();this._virtualFocus=null;break;}}else{switch(this._virtualFocus){case this.$.header:this._virtualFocus=this.$.items;e.preventDefault();break;case this.$.items:if(this._isFooterVisible()){this._virtualFocus=this.$.footer;e.preventDefault()}else{this.async(function(){this._virtualFocus=null},1)}break;case this.$.footer:this._virtualFocus=null;break;}}}else{this._activateNavigation();e.preventDefault()}},_isAboveViewport:function _isAboveViewport(index){return this.firstVisibleIndex>index},_onArrowDown:function _onArrowDown(e){if(this.interacting){return}e.preventDefault();this.navigating=!0;this._virtualFocus.focusDown();this._ensureVirtualFocusInViewport()},_scrollPageDown:function _scrollPageDown(){var headerRect=this.$.header.getBoundingClientRect(),footerRect=this.$.footer.getBoundingClientRect();this.$.scroller.$.table.scrollTop+=footerRect.top-headerRect.bottom;this.$.scroller._scrollHandler()},_onPageDown:function _onPageDown(e){if(this.interacting){return}e.preventDefault();this.navigating=!0;if(this._virtualFocus===this.$.items){var prevLastVisible=this.$.scroller.lastVisibleIndex;this._scrollPageDown();this._virtualFocus._focusedRowIndex+=this.$.scroller.lastVisibleIndex-prevLastVisible||this.$.scroller.lastVisibleIndex-this._virtualFocus._focusedRowIndex;this._ensureVirtualFocusInViewport()}else{this._virtualFocus.focusPageDown()}},_scrollPageUp:function _scrollPageUp(){var headerRect=this.$.header.getBoundingClientRect(),footerRect=this.$.footer.getBoundingClientRect();this.$.scroller.$.table.scrollTop-=footerRect.top-headerRect.bottom;this.$.scroller._scrollHandler()},_onPageUp:function _onPageUp(e){if(this.interacting){return}e.preventDefault();this.navigating=!0;if(this._virtualFocus===this.$.items){var prevLastVisibleIndex=this.$.scroller.lastVisibleIndex;this._scrollPageUp();this._virtualFocus._focusedRowIndex-=prevLastVisibleIndex-this.$.scroller.lastVisibleIndex||this._virtualFocus._focusedRowIndex;this._ensureVirtualFocusInViewport()}else{this._virtualFocus.focusPageUp()}},_onArrowUp:function _onArrowUp(e){if(this.interacting){return}e.preventDefault();this.navigating=!0;this._virtualFocus.focusUp();this._ensureVirtualFocusInViewport()},_onArrowRight:function _onArrowRight(e){if(this.interacting){return}e.preventDefault();this.navigating=!0;this._virtualFocus.focusRight();this._ensureVirtualFocusInViewport()},_onArrowLeft:function _onArrowLeft(e){if(this.interacting){return}e.preventDefault();this.navigating=!0;this._virtualFocus.focusLeft();this._ensureVirtualFocusInViewport()},_onHome:function _onHome(e){if(this.interacting){return}e.preventDefault();this.navigating=!0;this._virtualFocus.focusHome();this._ensureVirtualFocusInViewport()},_onEnd:function _onEnd(e){if(this.interacting){return}e.preventDefault();this.navigating=!0;this._virtualFocus.focusEnd();this._ensureVirtualFocusInViewport()},_moveFocusToFocusTarget:function _moveFocusToFocusTarget(){var content=this._virtualFocus._focusedCell._cellContent,focusTarget=content.querySelector("[focus-target]")||content.firstElementChild;if(focusTarget){focusTarget.focus()}},_onEnter:function _onEnter(e){if(!this.interacting){e.preventDefault();this._moveFocusToFocusTarget()}else if("input"===e.detail.keyboardEvent.target.localName&&"text"===e.detail.keyboardEvent.target.type){this.$.footerFocusTrap.focus()}},_onEscape:function _onEscape(){if(this.interacting){this.$.footerFocusTrap.focus()}else if(this.navigating){this.navigating=!1}},_onF2:function _onF2(e){e.preventDefault();if(!this.interacting){this._moveFocusToFocusTarget()}else{this.$.footerFocusTrap.focus()}},_onCtrlHome:function _onCtrlHome(e){if(this.interacting){return}e.preventDefault();this.navigating=!0;this._virtualFocus.focusFirst();this._ensureVirtualFocusInViewport()},_onCtrlEnd:function _onCtrlEnd(e){if(this.interacting){return}e.preventDefault();this.navigating=!0;this._virtualFocus.focusLast();this._ensureVirtualFocusInViewport()},_onSpace:function _onSpace(e){if(this.interacting){return}e.preventDefault();var focusedCell=this._virtualFocus._focusedCell,firstElementChild=focusedCell.getContentChildren(Polymer.Element?"slot":"content")[0].firstElementChild;if(firstElementChild){firstElementChild.click()}else if(this.navigating){this.fire("cell-activate",{model:focusedCell.instance})}},_onCellContentFocus:function _onCellContentFocus(e){this.interacting=!0;this._onCellFocus(e)},_onCellFocus:function _onCellFocus(e){var cell=e.detail.cell,row=cell.parentElement,container=row.parentElement,rowIndex=Array.prototype.indexOf.call(Polymer.dom(container).children,row);if(container===this.$.items){rowIndex=row.index}container._focusedRowIndex=rowIndex;container._focusedCellIndex=Array.prototype.indexOf.call(Polymer.dom(row).children,cell);this._virtualFocus=container;if(cell.hasAttribute("detailscell")){container._focusedCellIndex=0;container._moveFocusToDetailsCell()}},_ensureVirtualFocusInViewport:function _ensureVirtualFocusInViewport(){var scaledVirtualStart=this.$.scroller._vidxOffset+this.$.scroller._virtualStart,focusedIndex=this._virtualFocus._focusedRowIndex;if(this._virtualFocus===this.$.items&&(focusedIndex<scaledVirtualStart||focusedIndex>scaledVirtualStart+this.$.scroller._physicalCount)){this.$.scroller.scrollToScaledIndex(focusedIndex);this._virtualFocus._focusedCellChanged(focusedIndex,this._virtualFocus._focusedCellIndex)}this._ensureElementInViewport(this._virtualFocus._focusedCell)},_ensureElementInViewport:function _ensureElementInViewport(element){var elementRect=element.getBoundingClientRect();if(this._virtualFocus===this.$.items){var maxBottom=this.$.footer.getBoundingClientRect().top,minTop=this.$.header.getBoundingClientRect().bottom;if(elementRect.bottom>maxBottom){this.$.scroller.$.table.scrollTop+=elementRect.bottom-maxBottom}else if(elementRect.top<minTop){this.$.scroller.$.table.scrollTop+=elementRect.top-minTop}}if(element.hasAttribute("detailscell")){return}var maxRight=this.$.scroller.$.table.getBoundingClientRect().right,minLeft=this.$.scroller.$.table.getBoundingClientRect().left,lastFrozen=this._virtualFocus._focusedRow.querySelector("[last-frozen]");if(lastFrozen){minLeft=lastFrozen.getBoundingClientRect().right}if(elementRect.right>maxRight){this.$.scroller.$.table.scrollLeft+=elementRect.right-maxRight}else if(elementRect.left<minLeft){this.$.scroller.$.table.scrollLeft+=elementRect.left-minLeft}}};vaadin.elements.grid.TableKeyboardBehavior=[vaadin.elements.grid.TableKeyboardBehaviorImpl,Polymer.IronA11yKeysBehavior];</script></body></html>