<html><head><link rel="import" href="../iron-scroll-target-behavior/iron-scroll-target-behavior.html"><link rel="prefetch" href="../polymer/polymer.html"><link rel="prefetch" href="../polymer/polymer-mini.html"><link rel="prefetch" href="../polymer/polymer-micro.html"></head><body><dom-module id="vaadin-grid-table-table-scroll-styles"><template><style>#table{position:relative;overflow:auto;-webkit-overflow-scrolling:touch;z-index:-2;}vaadin-grid-table[ios] #table{transform:none;}vaadin-grid-table[fixed-sections] #table{transform:none;}</style></template></dom-module><dom-module id="vaadin-grid-table-scroll-styles"><template><style>vaadin-grid-table{transform:translateZ(0);}vaadin-grid-table-header{position:absolute;top:0;width:100%;}vaadin-grid-table-footer{position:absolute;bottom:0;width:100%;}vaadin-grid-table-body{z-index:-1;}vaadin-grid-table[fixed-sections]{transform:translateZ(0);overflow:hidden;}vaadin-grid-table[fixed-sections] vaadin-grid-table-header,
      vaadin-grid-table[fixed-sections] vaadin-grid-table-footer{position:fixed;}vaadin-grid-table[fixed-sections] vaadin-grid-table-body#items{position:fixed;width:100%;will-change:transform;}</style></template></dom-module><script>window.vaadin=window.vaadin||{};vaadin.elements=vaadin.elements||{};vaadin.elements.grid=vaadin.elements.grid||{};vaadin.elements.grid.TableScrollBehaviorImpl={properties:{_vidxOffset:{type:Number,value:0},ios:{type:Boolean,value:navigator.userAgent.match(/iP(?:hone|ad;(?: U;)? CPU) OS (\d+)/),reflectToAttribute:!0},fixedSections:{type:Boolean,reflectToAttribute:!0,computed:"_hasFixedSections(scrollbarWidth)"},_frozenCells:{type:Array,value:function value(){return[]}},scrolling:{type:Boolean,reflectToAttribute:!0}},ready:function ready(){this.scrollTarget=this.$.table},attached:function attached(){this.listen(this.scrollTarget,"wheel","_onWheel")},detached:function detached(){this.unlisten(this.scrollTarget,"wheel","_onWheel")},scrollToScaledIndex:function scrollToScaledIndex(idx){this._pendingScrollToScaledIndex=null;if(!this.$.items.style.borderTopWidth){this._pendingScrollToScaledIndex=idx}idx=Math.min(Math.max(idx,0),this.size-1);this.$.table.scrollTop=idx/this.size*this.$.table.scrollHeight;this._scrollHandler();this.scrollToIndex(idx-this._vidxOffset);this._resetScrollPosition(this._scrollPosition);this._scrollHandler();if(this._vidxOffset+this.lastVisibleIndex===this.size-1){this.$.table.scrollTop=this.$.table.scrollHeight-this.$.table.offsetHeight;this._scrollHandler()}},_hasFixedSections:function _hasFixedSections(scrollbarWidth){return navigator.userAgent.match(/Edge/)&&0===scrollbarWidth},_onWheel:function _onWheel(e){var _Mathabs=Math.abs;if(e.ctrlKey||this._hasScrolledAncestor(e.target,e.deltaX,e.deltaY)){return}var table=this.$.table,deltaY=e.deltaY;if(1===e.deltaMode){deltaY*=this._physicalAverage}var momentum=_Mathabs(e.deltaX)+_Mathabs(deltaY);if(this._canScroll(table,e.deltaX,deltaY)){e.preventDefault();table.scrollTop+=deltaY;table.scrollLeft+=e.deltaX;this._scrollHandler();this._hasResidualMomentum=!0;this._ignoreNewWheel=this.debounce("ignore-new-wheel",function(){this._ignoreNewWheel=null},500)}else if(this._hasResidualMomentum&&momentum<=this._previousMomentum||this._ignoreNewWheel){e.preventDefault()}else if(momentum>this._previousMomentum){this._hasResidualMomentum=!1}this._previousMomentum=momentum},_hasScrolledAncestor:function _hasScrolledAncestor(el,deltaX,deltaY){if(this._canScroll(el,deltaX,deltaY)){return!0}else if("vaadin-grid-cell-content"!==el.localName&&el!==this&&el.parentElement){return this._hasScrolledAncestor(el.parentElement,deltaX,deltaY)}},_canScroll:function _canScroll(el,deltaX,deltaY){return 0<deltaY&&el.scrollTop<el.scrollHeight-el.offsetHeight||0>deltaY&&0<el.scrollTop||0<deltaX&&el.scrollLeft<el.scrollWidth-el.offsetWidth||0>deltaX&&0<el.scrollLeft},_scrollHandler:function _scrollHandler(){var scrollTop=Math.max(0,Math.min(this._maxScrollTop,this._scrollTop)),delta=scrollTop-this._scrollPosition,tileHeight,kth,recycledTileSet,scrollBottom,physicalBottom,ratio=this._ratio,recycledTiles=0,hiddenContentSize=this._hiddenContentSize,currentRatio=ratio,movingUp=[];this._scrollPosition=scrollTop;this._firstVisibleIndexVal=null;this._lastVisibleIndexVal=null;scrollBottom=this._scrollBottom;physicalBottom=this._physicalBottom;if(Math.abs(delta)>this._physicalSize){this._physicalTop+=delta;recycledTiles=Math.round(delta/this._physicalAverage)}else if(0>delta){var topSpace=scrollTop-this._physicalTop,virtualStart=this._virtualStart;recycledTileSet=[];kth=this._physicalEnd;currentRatio=topSpace/hiddenContentSize;while(currentRatio<ratio&&recycledTiles<this._physicalCount&&0<virtualStart-recycledTiles&&physicalBottom-this._getPhysicalSizeIncrement(kth)>scrollBottom){tileHeight=this._getPhysicalSizeIncrement(kth);currentRatio+=tileHeight/hiddenContentSize;physicalBottom-=tileHeight;recycledTileSet.push(kth);recycledTiles++;kth=0===kth?this._physicalCount-1:kth-1}movingUp=recycledTileSet;recycledTiles=-recycledTiles}else if(0<delta){var bottomSpace=physicalBottom-scrollBottom,virtualEnd=this._virtualEnd,lastVirtualItemIndex=this._virtualCount-1;recycledTileSet=[];kth=this._physicalStart;currentRatio=bottomSpace/hiddenContentSize;while(currentRatio<ratio&&recycledTiles<this._physicalCount&&virtualEnd+recycledTiles<lastVirtualItemIndex&&this._physicalTop+this._getPhysicalSizeIncrement(kth)<scrollTop){tileHeight=this._getPhysicalSizeIncrement(kth);currentRatio+=tileHeight/hiddenContentSize;this._physicalTop+=tileHeight;recycledTileSet.push(kth);recycledTiles++;kth=(kth+1)%this._physicalCount}}if(this._virtualCount<this.size){this._adjustVirtualIndexOffset(delta)}if(0===recycledTiles){if(physicalBottom<scrollBottom||this._physicalTop>scrollTop){this._increasePoolIfNeeded()}}else{this._virtualStart=this._virtualStart+recycledTiles;this._physicalStart=this._physicalStart+recycledTiles;this._update(recycledTileSet,movingUp)}this._translateStationaryElements();if(!this.hasAttribute("reordering")){this.scrolling=!0}this.debounce("vaadin-grid-scrolling",function(){this.scrolling=!1;this._reorderRows()},100)},_adjustVirtualIndexOffset:function _adjustVirtualIndexOffset(delta){var _Mathround=Math.round,_Mathmin=Math.min;if(1e4<Math.abs(delta)){if(this._noScale){this._noScale=!1;return}var scale=_Mathround(1e3*(this._scrollPosition/this._scrollHeight))/1e3,offset=scale*this.size;this._vidxOffset=_Mathround(offset-scale*this._virtualCount);if(0===this._scrollTop){this.scrollToIndex(0)}}else{var oldOffset=this._vidxOffset||0,threshold=1e3,maxShift=100;if(0===this._scrollTop){this._vidxOffset=0;if(oldOffset!==this._vidxOffset){this.scrollToIndex(0)}}else if(this.firstVisibleIndex<threshold&&0<this._vidxOffset){this._vidxOffset-=_Mathmin(this._vidxOffset,maxShift);this.scrollToIndex(this.firstVisibleIndex+(oldOffset-this._vidxOffset)+1);this._noScale=!0}var maxOffset=this.size-this._virtualCount;if(this._scrollTop>=this._maxScrollTop){this._vidxOffset=maxOffset;if(oldOffset!==this._vidxOffset){this.scrollToIndex(this._virtualCount)}}else if(this.firstVisibleIndex>this._virtualCount-threshold&&this._vidxOffset<maxOffset){this._vidxOffset+=_Mathmin(maxOffset-this._vidxOffset,maxShift);this.scrollToIndex(this.firstVisibleIndex-(this._vidxOffset-oldOffset));this._noScale=!0}}},_reorderRows:function _reorderRows(){var body=Polymer.dom(this.$.items),items=body.querySelectorAll(".vaadin-grid-row"),_adjustedVirtualStart=this._virtualStart+this._vidxOffset,physicalIndexOfFirst=items.length-(items[0].index-_adjustedVirtualStart);if(physicalIndexOfFirst<items.length/2){for(var i=0;i<physicalIndexOfFirst;i++){body.appendChild(items[i])}}else{for(var j=physicalIndexOfFirst;j<items.length;j++){body.insertBefore(items[j],items[0])}}},_frozenCellsChanged:function _frozenCellsChanged(){this.debounce("cache-elements",function(){Polymer.dom(this.domHost.root).querySelectorAll(".vaadin-grid-cell").forEach(function(cell){cell.style.transform=""});this._frozenCells=Array.prototype.slice.call(Polymer.dom(this.domHost.root).querySelectorAll("[frozen]"));this._translateStationaryElements()});this._updateLastFrozen()},_updateLastFrozen:function _updateLastFrozen(){if(!this.columnTree){return}var columnsRow=this.columnTree[this.columnTree.length-1].slice(0);columnsRow.sort(function(a,b){return a._order-b._order});var lastFrozen=columnsRow.reduce(function(prev,col,index){col._lastFrozen=!1;return col.frozen&&!col.hidden?index:prev},void 0);if(lastFrozen!==void 0){columnsRow[lastFrozen]._lastFrozen=!0}},_translateStationaryElements:function _translateStationaryElements(){if(this.fixedSections){this.$.items.style.transform=this._getTranslate(-this._scrollLeft||0,-this._scrollTop||0);this.$.footer.style.transform=this.$.header.style.transform=this._getTranslate(-this._scrollLeft||0,0)}else{this.$.footer.style.transform=this.$.header.style.transform=this._getTranslate(0,this._scrollTop)}for(var frozenCellTransform=this._getTranslate(this._scrollLeft,0),i=0;i<this._frozenCells.length;i++){this._frozenCells[i].style.transform=frozenCellTransform}},_getTranslate:function _getTranslate(x,y){return"translate("+x+"px,"+y+"px)"}};vaadin.elements.grid.TableScrollBehavior=[Polymer.IronScrollTargetBehavior,vaadin.elements.grid.TableScrollBehaviorImpl];</script></body></html>