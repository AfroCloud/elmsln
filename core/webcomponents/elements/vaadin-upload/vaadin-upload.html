<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../iron-flex-layout/iron-flex-layout.html"><link rel="import" href="../paper-styles/typography.html"><link rel="import" href="../paper-ripple/paper-ripple.html"><link rel="import" href="../paper-button/paper-button.html"><link rel="import" href="vaadin-upload-icons.html"><link rel="import" href="vaadin-upload-file.html"><link rel="prefetch" href="../polymer/polymer-mini.html"><link rel="prefetch" href="../polymer/polymer-micro.html"><link rel="prefetch" href="../font-roboto/roboto.html"><link rel="prefetch" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html"><link rel="prefetch" href="../paper-behaviors/paper-button-behavior.html"><link rel="prefetch" href="../iron-behaviors/iron-button-state.html"><link rel="prefetch" href="../iron-behaviors/iron-control-state.html"><link rel="prefetch" href="../paper-behaviors/paper-ripple-behavior.html"><link rel="prefetch" href="../paper-styles/element-styles/paper-material-styles.html"><link rel="prefetch" href="../paper-styles/shadow.html"><link rel="prefetch" href="../iron-iconset-svg/iron-iconset-svg.html"><link rel="prefetch" href="../iron-meta/iron-meta.html"><link rel="prefetch" href="../iron-icon/iron-icon.html"><link rel="prefetch" href="../paper-icon-button/paper-icon-button.html"><link rel="prefetch" href="../paper-behaviors/paper-inky-focus-behavior.html"><link rel="prefetch" href="../paper-styles/default-theme.html"><link rel="prefetch" href="../paper-styles/color.html"><link rel="prefetch" href="../paper-progress/paper-progress.html"><link rel="prefetch" href="../iron-range-behavior/iron-range-behavior.html"></head><body><dom-module id="vaadin-upload"><template><style>:host{@apply --layout-vertical;display:block;position:relative;text-align:left;}:host(:not([nodrop])){border:1px dashed;border-color:var(--divider-color, #666);border-radius:3px;overflow:hidden;padding:16px;}:host([dragover-valid]){border-color:var(--primary-color, #00B4F0);}:host::before{@apply --layout-fit;content:'';display:none;z-index:10;}:host([dragover])::before{display:block;}#dragRipple{color:var(--light-primary-color, #7CD8F7);@apply --vaadin-upload-drag-ripple;}#dropLabel{@apply --layout-flex;@apply --paper-font-body2;position:relative;padding:.43em .57em;margin:0 .29em;color:var(--disabled-text-color, #b3b3b3);@apply --vaadin-upload-drop-label;}:host([dragover-valid]) #dropLabel{color:var(--primary-color, #00B4F0);@apply --vaadin-upload-drop-label-dragover;}#dropLabel ::slotted(iron-icon),
      #dropLabelIcon{margin-right:.25em;@apply --vaadin-upload-drop-label-icon;}#fileList{position:relative;@apply --vaadin-upload-file-list;}#buttons{@apply --layout-horizontal;position:relative;@apply --vaadin-upload-buttons;}#buttonsPrimary{@apply --layout-horizontal;@apply --layout-flex;@apply --layout-start;margin-left:-.29em;@apply --vaadin-upload-buttons-primary;}#addFiles{@apply --vaadin-upload-button-add-wrapper;}#addButton{@apply --paper-font-button;padding:.43em .57em;background:var(--primary-color, #00B4F0);color:var(--primary-font-color, #FFF);@apply --vaadin-upload-button-add;}#addButton[disabled]{background:var(--divider-color, #e0e0e0);color:var(--disabled-text-color, gray);@apply --vaadin-upload-button-add-disabled;}</style><div id="buttons"><div id="buttonsPrimary"><div id="addFiles" on-tap="_onAddFilesClick"><slot name="add-button"><paper-button id="addButton" disabled$="[[maxFilesReached]]">[[_i18nPlural(maxFiles, i18n.addFiles, i18n.addFiles.*)]]</paper-button></slot></div><div id="dropLabel" hidden$="[[nodrop]]"><slot name="drop-label-icon"><iron-icon id="dropLabelIcon" icon="vaadin-upload:file-upload"></iron-icon></slot><slot name="drop-label">[[_i18nPlural(maxFiles, i18n.dropFiles, i18n.dropFiles.*)]]</slot></div></div></div><slot name="file-list"><div id="fileList"><template is="dom-repeat" items="[[files]]" as="file"><vaadin-upload-file file="[[file]]"></vaadin-upload-file></template></div></slot><slot></slot><input type="file" id="fileInput" on-change="_onFileInputChange" hidden="" accept$="{{accept}}" multiple$="[[_isMultiple(maxFiles)]]"><paper-ripple id="dragRipple" noink=""></paper-ripple></template></dom-module><script>Polymer({is:"vaadin-upload",properties:{nodrop:{type:Boolean,reflectToAttribute:!0,value:function value(){try{return!!document.createEvent("TouchEvent")}catch(e){return!1}}},target:{type:String,value:""},method:{type:String,value:"POST"},headers:{type:Object,value:{}},timeout:{type:Number,value:0},_dragover:{type:Boolean,value:!1,observer:"_dragoverChanged"},files:{type:Array,notify:!0,value:function value(){return[]}},maxFiles:{type:Number,value:1/0},maxFilesReached:{type:Boolean,value:!1,notify:!0,readOnly:!0,computed:"_maxFilesAdded(maxFiles, files.length)"},accept:{type:String,value:""},maxFileSize:{type:Number,value:1/0},_dragoverValid:{type:Boolean,value:!1,observer:"_dragoverValidChanged"},formDataName:{type:String,value:"file"},noAuto:{type:Boolean,value:!1},i18n:{type:Object,value:function value(){return{dropFiles:{one:"Drop file here...",many:"Drop files here..."},addFiles:{one:"Select File",many:"Upload Files"},cancel:"Cancel",error:{tooManyFiles:"Too Many Files.",fileIsTooBig:"File is Too Big.",incorrectFileType:"Incorrect File Type."},uploading:{status:{connecting:"Connecting...",stalled:"Stalled.",processing:"Processing File...",held:"Queued"},remainingTime:{prefix:"remaining time: ",unknown:"unknown remaining time"},error:{serverUnavailable:"Server Unavailable",unexpectedServerError:"Unexpected Server Error",forbidden:"Forbidden"}},units:{size:["B","kB","MB","GB","TB","PB","EB","ZB","YB"]}}}}},listeners:{dragover:"_onDragover",dragleave:"_onDragleave",drop:"_onDrop","file-retry":"_onFileRetry","file-abort":"_onFileAbort","file-remove":"_onFileRemove","file-start":"_onFileStart"},_formatSize:function _formatSize(bytes){var _Mathlog=Math.log;if("function"===typeof this.i18n.formatSize){return this.i18n.formatSize(bytes)}var base=this.i18n.units.sizeBase||1e3,unit=~~(_Mathlog(bytes)/_Mathlog(base)),dec=Math.max(0,Math.min(3,unit-1)),size=parseFloat((bytes/Math.pow(base,unit)).toFixed(dec));return size+" "+this.i18n.units.size[unit]},_splitTimeByUnits:function _splitTimeByUnits(time){for(var unitSizes=[60,60,24,1/0],timeValues=[0],i=0;i<unitSizes.length&&0<time;i++){timeValues[i]=time%unitSizes[i];time=Math.floor(time/unitSizes[i])}return timeValues},_formatTime:function _formatTime(seconds,split){if("function"===typeof this.i18n.formatTime){return this.i18n.formatTime(seconds,split)}while(3>split.length){split.push(0)}return split.reverse().map(function(number){return(10>number?"0":"")+number}).join(":")},_formatFileProgress:function _formatFileProgress(file){return file.totalStr+": "+file.progress+"% ("+(0<file.loaded?this.i18n.uploading.remainingTime.prefix+file.remainingStr:this.i18n.uploading.remainingTime.unknown)+")"},_maxFilesAdded:function _maxFilesAdded(maxFiles,numFiles){return 0<=maxFiles&&numFiles>=maxFiles},_dragRippleAction:function _dragRippleAction(action,event){var rippleActionEvent={detail:{x:event.clientX,y:event.clientY}};if("down"==action){this.$.dragRipple.downAction(rippleActionEvent);var lastRipple=this.$.dragRipple.ripples[this.$.dragRipple.ripples.length-1];if(!lastRipple.hasOwnProperty("radius")){Object.defineProperty(lastRipple,"radius",{get:function get(){var width2=this.containerMetrics.width*this.containerMetrics.width,height2=this.containerMetrics.height*this.containerMetrics.height,waveRadius=1.1*Math.sqrt(width2+height2)+5,timeNow=this.mouseInteractionSeconds/(.9+.2*(waveRadius/300)),size=waveRadius*(1-Math.pow(80,-timeNow));return Math.abs(size)}})}}else{this.$.dragRipple.upAction(rippleActionEvent)}},_onDragover:function _onDragover(event){event.preventDefault();if(!this.nodrop&&!this._dragover){this._dragoverValid=!this.maxFilesReached;if(this._dragoverValid){this._dragRippleAction("down",event)}this._dragover=!0}event.dataTransfer.dropEffect=!this._dragoverValid||this.nodrop?"none":"copy"},_onDragleave:function _onDragleave(event){if(Polymer.dom(event).rootTarget===this){event.preventDefault();if(this._dragover&&!this.nodrop){this._dragRippleAction("up",event);this._dragover=this._dragoverValid=!1}}},_onDrop:function _onDrop(event){if(!this.nodrop){event.preventDefault();this._dragRippleAction("up",event);this._dragover=this._dragoverValid=!1;this._dragRippleAction("upAction",event);this._addFiles(event.dataTransfer.files)}},_createXhr:function _createXhr(){return new XMLHttpRequest},_configureXhr:function _configureXhr(xhr){if("string"==typeof this.headers){try{this.headers=JSON.parse(this.headers)}catch(e){this.headers=void 0}}for(var key in this.headers){xhr.setRequestHeader(key,this.headers[key])}if(this.timeout){xhr.timeout=this.timeout}},_setStatus:function _setStatus(file,total,loaded,elapsed){file.elapsed=elapsed;file.elapsedStr=this._formatTime(file.elapsed,this._splitTimeByUnits(file.elapsed));file.remaining=Math.ceil(elapsed*(total/loaded-1));file.remainingStr=this._formatTime(file.remaining,this._splitTimeByUnits(file.remaining));file.speed=~~(total/elapsed/1024);file.totalStr=this._formatSize(total);file.loadedStr=this._formatSize(loaded);file.status=this._formatFileProgress(file)},uploadFiles:function uploadFiles(files){files=files||this.files;files=files.filter(function(file){return!file.complete});Array.prototype.forEach.call(files,this._uploadFile.bind(this))},_uploadFile:function _uploadFile(file){if(file.uploading){return}var ini=Date.now(),xhr=file.xhr=this._createXhr(file),stalledId,last;xhr.upload.onprogress=function(e){clearTimeout(stalledId);last=Date.now();var elapsed=(last-ini)/1e3,loaded=e.loaded,total=e.total,progress=~~(100*(loaded/total));file.loaded=loaded;file.progress=progress;file.indeterminate=0>=loaded||loaded>=total;if(file.error){file.indeterminate=file.status=void 0}else if(!file.abort){if(100>progress){this._setStatus(file,total,loaded,elapsed);stalledId=setTimeout(function(){file.status=this.i18n.uploading.status.stalled;this._notifyFileChanges(file)}.bind(this),2e3)}else{file.loadedStr=file.totalStr;file.status=this.i18n.uploading.status.processing;file.uploading=!1}}this._notifyFileChanges(file);this.fire("upload-progress",{file:file,xhr:xhr})}.bind(this);xhr.onreadystatechange=function(){if(4==xhr.readyState){clearTimeout(stalledId);file.indeterminate=file.uploading=!1;if(file.abort){this._notifyFileChanges(file);return}file.status="";var evt=this.fire("upload-response",{file:file,xhr:xhr},{cancelable:!0});if(evt.defaultPrevented){return}if(0===xhr.status){file.error=this.i18n.uploading.error.serverUnavailable}else if(500<=xhr.status){file.error=this.i18n.uploading.error.unexpectedServerError}else if(400<=xhr.status){file.error=this.i18n.uploading.error.forbidden}file.complete=!file.error;this.fire("upload-"+(file.error?"error":"success"),{file:file,xhr:xhr});this._notifyFileChanges(file)}}.bind(this);var formData=new FormData;file.uploadTarget=this.target||"";file.formDataName=this.formDataName;var evt=this.fire("upload-before",{file:file,xhr:xhr},{cancelable:!0});if(evt.defaultPrevented){return}formData.append(file.formDataName,file,file.name);xhr.open(this.method,file.uploadTarget,!0);this._configureXhr(xhr);file.status=this.i18n.uploading.status.connecting;file.uploading=file.indeterminate=!0;file.complete=file.abort=file.error=file.held=!1;xhr.upload.onloadstart=function(){this.fire("upload-start",{file:file,xhr:xhr});this._notifyFileChanges(file)}.bind(this);evt=this.fire("upload-request",{file:file,xhr:xhr,formData:formData},{cancelable:!0});if(!evt.defaultPrevented){xhr.send(formData)}},_retryFileUpload:function _retryFileUpload(file){var evt=this.fire("upload-retry",{file:file,xhr:file.xhr},{cancelable:!0});if(!evt.defaultPrevented){this.async(this._uploadFile.bind(this,file))}},_abortFileUpload:function _abortFileUpload(file){var evt=this.fire("upload-abort",{file:file,xhr:file.xhr},{cancelable:!0});if(!evt.defaultPrevented){file.abort=!0;if(file.xhr){file.xhr.abort()}this._notifyFileChanges(file)}},_notifyFileChanges:function _notifyFileChanges(file){var p="files."+this.files.indexOf(file)+".";for(var i in file){if(file.hasOwnProperty(i)){this.notifyPath(p+i,file[i])}}},_addFiles:function _addFiles(files){Array.prototype.forEach.call(files,this._addFile.bind(this))},_addFile:function _addFile(file){if(this.maxFilesReached){this.fire("file-reject",{file:file,error:this.i18n.error.tooManyFiles});return}if(0<=this.maxFileSize&&file.size>this.maxFileSize){this.fire("file-reject",{file:file,error:this.i18n.error.fileIsTooBig});return}var fileExt=file.name.match(/\.[^\.]*$|$/)[0],re=new RegExp("^("+this.accept.replace(/[, ]+/g,"|").replace(/\/\*/g,"/.*")+")$","i");if(this.accept&&!(re.test(file.type)||re.test(fileExt))){this.fire("file-reject",{file:file,error:this.i18n.error.incorrectFileType});return}file.loaded=0;file.held=!0;file.status=this.i18n.uploading.status.held;this.unshift("files",file);if(!this.noAuto){this._uploadFile(file)}},_removeFile:function _removeFile(file){this.splice("files",this.files.indexOf(file),1)},_onAddFilesClick:function _onAddFilesClick(){if(this.maxFilesReached){return}if(Polymer.Gestures.resetMouseCanceller){Polymer.Gestures.resetMouseCanceller()}this.$.fileInput.value="";this.$.fileInput.click()},_onFileInputChange:function _onFileInputChange(event){this._addFiles(event.target.files)},_onFileStart:function _onFileStart(event){this._uploadFile(event.detail.file)},_onFileRetry:function _onFileRetry(event){this._retryFileUpload(event.detail.file)},_onFileAbort:function _onFileAbort(event){this._abortFileUpload(event.detail.file)},_onFileRemove:function _onFileRemove(event){event.stopPropagation();this._removeFile(event.detail.file)},_dragoverChanged:function _dragoverChanged(dragover){this.toggleAttribute("dragover",dragover)},_dragoverValidChanged:function _dragoverValidChanged(dragoverValid){this.toggleAttribute("dragover-valid",dragoverValid)},_i18nPlural:function _i18nPlural(value,plural){return 1==value?plural.one:plural.many},_isMultiple:function _isMultiple(){return 1!=this.maxFiles}});</script></body></html>