<html><head></head><body><dom-module id="vaadin-grid-data-provider-themability-styles"><template><style>@keyframes vaadin-grid-spin-360{100%{transform:rotate(360deg);}}@-webkit-keyframes vaadin-grid-spin-360{100%{-webkit-transform:rotate(360deg);transform:rotate(360deg);}}#spinner{border:2px solid var(--primary-color, #03A9F4);border-radius:50%;border-right-color:transparent;border-top-color:transparent;content:"";height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px;pointer-events:none;opacity:0;@apply (--vaadin-grid-loading-spinner);}:host([loading]) #spinner{opacity:1;-webkit-animation:vaadin-grid-spin-360 400ms linear infinite;animation:vaadin-grid-spin-360 400ms linear infinite;}:host([loading]) #items{opacity:0.5;}</style></template></dom-module><script>window.vaadin=window.vaadin||{};vaadin.elements=vaadin.elements||{};vaadin.elements.grid=vaadin.elements.grid||{};vaadin.elements.grid.DataProviderBehavior={listeners:{"item-changed":"_templateItemChanged"},properties:{pageSize:{type:Number,value:50,observer:"_pageSizeChanged"},dataProvider:{type:Object,notify:!0,observer:"_dataProviderChanged"},_loading:Boolean,_cache:{type:Object,value:function value(){return{}}},_pendingRequests:{type:Object,value:function value(){return{}}}},_templateItemChanged:function _templateItemChanged(e){var item=e.detail.item;Array.prototype.forEach.call(Polymer.dom(this.$.items).children,function(row){if(row.item===item){row.iterateCells(function(cell){cell._templatizer._suppressItemChangeEvent=!0;cell.instance.notifyPath("item."+e.detail.path,e.detail.value);cell._templatizer._suppressItemChangeEvent=!1})}})},_getCachedItem:function _getCachedItem(index){var page=this._getPageForIndex(index),p=this._cache&&this._cache[page];if(p){return p[index-page*this.pageSize]}else{return null}},_getItem:function _getItem(index,el){this._updateItem(el,this._getCachedItem(index));this._eagerlyLoadPages();var uncachedPages=this._uncachedPagesForPhysicalItems();if(0<uncachedPages.length){this._loading=!0;this.debounce("load",function(){uncachedPages.forEach(function(i){this._loadPage(i)}.bind(this))},100)}},_cachedPagesForPhysicalItems:function _cachedPagesForPhysicalItems(){return this._pagesForPhysicalItems().filter(function(page){return this._cache!==void 0&&this._cache[page]!==void 0}.bind(this))},_uncachedPagesForPhysicalItems:function _uncachedPagesForPhysicalItems(){return this._pagesForPhysicalItems().filter(function(page){return this._cache!==void 0&&this._cache[page]===void 0}.bind(this))},_eagerlyLoadPages:function _eagerlyLoadPages(){var _Mathmax=Math.max,pages=this._cachedPagesForPhysicalItems().slice(0);if(0<pages.length){pages.sort(function(a,b){return a>b});var prev=_Mathmax(0,pages[0]-1),next=Math.min(pages[pages.length-1]+1,_Mathmax(0,Math.floor(this.size/this.pageSize)-1));this._loadPage(prev);this._loadPage(next)}},_pagesForPhysicalItems:function _pagesForPhysicalItems(){var firstVisiblePage=this._getPageForIndex(this.$.scroller.firstVisibleIndex+this.$.scroller._vidxOffset);return[firstVisiblePage].concat(this.$.scroller._physicalItems.filter(function(row){return row.index}).map(function(row){return this._getPageForIndex(row.index)}.bind(this))).reduce(function(prev,curr){if(-1===prev.indexOf(curr)){prev.push(curr)}return prev},[])},_updateItems:function _updateItems(page,items){for(var i=0;i<this.pageSize;i++){var index=page*this.pageSize+i,row=this.$.scroller._virtualIndexToItem[index];if(row){this._updateItem(row,items[i]);this.debounce("update-heights",function(){this.$.scroller._updateMetrics();this.$.scroller._positionItems();this.$.scroller._updateScrollerSize()},1)}}},_loadPage:function _loadPage(page,cb){cb=cb||this._updateItems.bind(this);if(!this._cache[page]){if(!this._pendingRequests[page]&&this.dataProvider){this._pendingRequests[page]=!0;var params={page:page,pageSize:this.pageSize,sortOrders:this._mapSorters(),filters:this._mapFilters()};this.dataProvider(params,function(items){this._cache[page]=items;delete this._pendingRequests[page];cb(page,items);this._loading=0<this._pendingRequests.length;this.debounce("check-size",this._checkSize,2e3)}.bind(this))}}},_getPageForIndex:function _getPageForIndex(index){return Math.floor(index/this.pageSize)},clearCache:function clearCache(){this._cache={};this._pendingRequests={};if(this.$.scroller.hasData){this.$.scroller._update()}this._flushItemsDebouncer()},_flushItemsDebouncer:function _flushItemsDebouncer(){this.flushDebouncer("load")},_pageSizeChanged:function _pageSizeChanged(pageSize,oldPageSize){if(oldPageSize!==void 0&&pageSize!==oldPageSize){this.clearCache()}},_checkSize:function _checkSize(){if(this.size===void 0){console.warn("The <vaadin-grid> needs a value for \"size\" property in order to display rows.")}},_dataProviderChanged:function _dataProviderChanged(dataProvider,oldDataProvider){if(oldDataProvider!==void 0){this.clearCache()}if(!this.$.scroller.hasData){this._loading=!0;this._loadPage(0,function(){this.$.scroller.hasData=!0}.bind(this))}}};</script></body></html>