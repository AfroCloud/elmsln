<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html"><link rel="prefetch" href="../polymer/polymer-mini.html"><link rel="prefetch" href="../polymer/polymer-micro.html"><link rel="prefetch" href="../iron-icon/iron-icon.html"><link rel="prefetch" href="../iron-meta/iron-meta.html"><link rel="prefetch" href="../iron-flex-layout/iron-flex-layout.html"><link rel="prefetch" href="../iron-iconset-svg/iron-iconset-svg.html"><link rel="prefetch" href="../paper-behaviors/paper-inky-focus-behavior.html"><link rel="prefetch" href="../iron-behaviors/iron-button-state.html"><link rel="prefetch" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html"><link rel="prefetch" href="../iron-behaviors/iron-control-state.html"><link rel="prefetch" href="../paper-behaviors/paper-ripple-behavior.html"><link rel="prefetch" href="../paper-ripple/paper-ripple.html"><link rel="prefetch" href="../paper-styles/default-theme.html"><link rel="prefetch" href="../paper-styles/color.html"><link rel="prefetch" href="../iron-collapse/iron-collapse.html"><link rel="prefetch" href="../iron-resizable-behavior/iron-resizable-behavior.html"><link rel="prefetch" href="../paper-item/paper-item-body.html"><link rel="prefetch" href="../paper-styles/typography.html"><link rel="prefetch" href="../font-roboto/roboto.html"><link rel="prefetch" href="../paper-styles/paper-styles.html"><link rel="prefetch" href="../paper-styles/shadow.html"><link rel="prefetch" href="../paper-collapse-item/simple-paper-item.html"><link rel="prefetch" href="../paper-item/paper-item-behavior.html"><link rel="prefetch" href="../paper-item/paper-item-shared-styles.html"><link rel="prefetch" href="../iron-ajax/iron-ajax.html"><link rel="prefetch" href="../iron-ajax/iron-request.html"><link rel="prefetch" href="../intl-messageformat/dist/intl-messageformat.min.js"><link rel="prefetch" href="../paper-checkbox/paper-checkbox.html"><link rel="prefetch" href="../paper-behaviors/paper-checked-element-behavior.html"><link rel="prefetch" href="../iron-checked-element-behavior/iron-checked-element-behavior.html"><link rel="prefetch" href="../iron-validatable-behavior/iron-validatable-behavior.html"><link rel="prefetch" href="../iron-form-element-behavior/iron-form-element-behavior.html"><link rel="prefetch" href="../paper-dropdown-menu/paper-dropdown-menu.html"><link rel="prefetch" href="../paper-input/paper-input.html"><link rel="prefetch" href="../iron-input/iron-input.html"><link rel="prefetch" href="../iron-a11y-announcer/iron-a11y-announcer.html"><link rel="prefetch" href="../paper-input/paper-input-behavior.html"><link rel="prefetch" href="../paper-input/paper-input-char-counter.html"><link rel="prefetch" href="../paper-input/paper-input-addon-behavior.html"><link rel="prefetch" href="../paper-input/paper-input-container.html"><link rel="prefetch" href="../paper-input/paper-input-error.html"><link rel="prefetch" href="../paper-menu-button/paper-menu-button.html"><link rel="prefetch" href="../iron-dropdown/iron-dropdown.html"><link rel="prefetch" href="../iron-overlay-behavior/iron-overlay-behavior.html"><link rel="prefetch" href="../iron-fit-behavior/iron-fit-behavior.html"><link rel="prefetch" href="../iron-overlay-behavior/iron-overlay-manager.html"><link rel="prefetch" href="../iron-overlay-behavior/iron-overlay-backdrop.html"><link rel="prefetch" href="../iron-overlay-behavior/iron-scroll-manager.html"><link rel="prefetch" href="../iron-overlay-behavior/iron-focusables-helper.html"><link rel="prefetch" href="../neon-animation/neon-animation-runner-behavior.html"><link rel="prefetch" href="../neon-animation/neon-animatable-behavior.html"><link rel="prefetch" href="../iron-dropdown/iron-dropdown-scroll-manager.html"><link rel="prefetch" href="../neon-animation/animations/fade-in-animation.html"><link rel="prefetch" href="../neon-animation/neon-animation-behavior.html"><link rel="prefetch" href="../neon-animation/animations/fade-out-animation.html"><link rel="prefetch" href="../paper-menu-button/paper-menu-button-animations.html"><link rel="prefetch" href="../paper-dropdown-menu/paper-dropdown-menu-icons.html"><link rel="prefetch" href="../paper-dropdown-menu/paper-dropdown-menu-shared-styles.html"><link rel="prefetch" href="../paper-menu/paper-menu.html"><link rel="prefetch" href="../iron-menu-behavior/iron-menu-behavior.html"><link rel="prefetch" href="../iron-selector/iron-multi-selectable.html"><link rel="prefetch" href="../iron-selector/iron-selectable.html"><link rel="prefetch" href="../iron-selector/iron-selection.html"><link rel="prefetch" href="../paper-menu/paper-menu-shared-styles.html"><link rel="prefetch" href="../paper-item/paper-item.html"><link rel="prefetch" href=""><link rel="prefetch" href="../paper-button/paper-button.html"><link rel="prefetch" href="../paper-behaviors/paper-button-behavior.html"><link rel="prefetch" href="../paper-styles/element-styles/paper-material-styles.html"><link rel="prefetch" href="eco-json-schema-geolocation.html"><link rel="prefetch" href="../iron-icons/communication-icons.html"><link rel="prefetch" href="../geo-location/geo-location.html"><link rel="prefetch" href="../google-map/google-map.html"><link rel="prefetch" href="../google-apis/google-maps-api.html"><link rel="prefetch" href="../iron-jsonp-library/iron-jsonp-library.html"><link rel="prefetch" href="../iron-selector/iron-selector.html"><link rel="prefetch" href="../google-map/google-map-marker.html"></head><body><dom-module id="eco-json-schema-array"><link rel="import" href="../iron-icons/iron-icons.html"><link rel="import" href="../iron-icons/editor-icons.html"><link rel="import" href="../paper-icon-button/paper-icon-button.html"><link rel="import" href="../paper-collapse-item/paper-collapse-item.html"><link rel="import" href="../paper-collapse-item/paper-collapse-group.html"><link rel="import" href="../app-localize-behavior/app-localize-behavior.html"><link rel="import" href="./eco-json-schema-boolean.html"><link rel="import" href="./eco-json-schema-enum.html"><link rel="import" href="./eco-json-schema-input.html"><link rel="import" href="./eco-json-schema-object.html"><link rel="import" href="./eco-json-schema-file.html"><template><style is="custom-style" include="iron-flex iron-flex-alignment">paper-input{padding:2px;--paper-input-container-label:{white-space:normal;position:static;font-size:22px;color:#212121;};}paper-collapse-item{--paper-collapse-item-header:{font-weight:bold;padding:8px 0 0 8px;};}#form{border:1px solid #AAAAAA;}#form div:nth-child(odd){background-color:#F2F2F2;padding:4px;}#form div:nth-child(even){background-color:#E2E2E2;border-top:1px solid #AAAAAA;border-bottom:1px solid #AAAAAA;padding:4px;}#form div:focus,
      #form div:hover,
      #form div:active{background-color:#FFFFFF !important;}paper-icon-button{float:right;border-radius:50%;}.array-add{color:#34e79a;background-color:#f8f8f8;}.array-remove-element{color:#f44336;background-color:#f8f8f8;}.label{@apply (--paper-input-container-label);white-space:normal;position:static;font-size:22px;color:#212121;}:host{display:block;.label{@apply (--paper-input-container-label);white-space:normal;position:static;font-size:22px;color:#212121;}}</style><div class="horizontal layout"><div class="flex" hidden$="[[!label]]">[[label]]</div><paper-icon-button id="addarray" title="Add another item" class="array-add" icon="add" on-click="_onAddItem" role="button" aria-label="Add another item"></paper-icon-button></div><paper-collapse-group id="form" class="vertical flex layout"></paper-collapse-group></template><script>Polymer({is:"eco-json-schema-array",properties:{schema:{type:Object,observer:"_schemaChanged"},label:{type:String},value:{type:Array,notify:!0,value:function value(){return[]},observer:"_valueChanged"},error:{type:Object,observer:"_errorChanged"},_schemaArrayItems:{type:Array,notify:!0,value:function value(){return[]}}},observers:["_schemaArraySplicesChanged(_schemaArrayItems.splices)"],_valueChanged:function _valueChanged(newValue,oldValue){var _this=this;if(newValue!==oldValue&&babelHelpers.typeof(newValue)!=="undefined"&&babelHelpers.typeof(this.schema)!=="undefined"){setTimeout(function(){_this._buildSchemaArrayItems();for(var i in newValue){_this._onAddItemWithValue(newValue[i],parseInt(i))}},100)}},ready:function ready(){},detached:function detached(){this._clearForm()},_buildSchemaArrayItems:function _buildSchemaArrayItems(){this._schemaArrayItems=[]},_setValue:function _setValue(){this.value=[];this.value=this._schemaArrayItems.map(function(item){return item.value})},_schemaArraySplicesChanged:function _schemaArraySplicesChanged(detail){if(!detail){return console.warn("detail is undefined")}var ctx=this;if(detail.keySplices){console.warn("Got keySplices, don't know what to do with them!")}detail.indexSplices.forEach(function(splice){var args=["value",splice.index,splice.removed.length];if(splice.removed&&splice.removed.length){for(var i=splice.index,ii=splice.index+splice.removed.length;i<ii;i++){ctx._removeArrayEl(ctx.$.form.children[i])}}if(splice.addedCount){for(var i=splice.index,ii=splice.index+splice.addedCount;i<ii;i++){var item=splice.object[i],componentEl=ctx.create(item.component.name,{label:item.label,schema:item.schema,schemaArrayItem:item}),containerEl=ctx.create("paper-collapse-item",{header:"Item "+(i+1)}),buttonEl=ctx.create("paper-icon-button",{icon:"remove",title:"Remove item"});ctx.listen(buttonEl,"tap","_onRemoveItem");buttonEl.classList.add("array-remove-element");componentEl.classList.add("flex","horizontal","layout");Polymer.dom(containerEl).appendChild(componentEl);Polymer.dom(containerEl).appendChild(buttonEl);var beforeEl=ctx.$.form.children[i];if(beforeEl){Polymer.dom(ctx.$.form).insertBefore(containerEl,beforeEl)}else{Polymer.dom(ctx.$.form).appendChild(containerEl)}ctx.listen(componentEl,item.component.valueProperty.replace(/([A-Z])/g,"-$1").toLowerCase()+"-changed","_schemaArrayItemChanged");args.push(ctx._deepClone(componentEl[item.component.valueProperty]))}}ctx.splice.apply(ctx,args)})},_schemaArrayItemChanged:function _schemaArrayItemChanged(event,detail){if(detail.path&&/\.length$/.test(detail.path)){return}var ctx=this,item=event.target.schemaArrayItem,index=this._schemaArrayItems.indexOf(item),path=["value",index];if(detail.path&&/\.splices$/.test(detail.path)){path=path.concat(detail.path.split(".").slice(1,-1));if(detail.value.keySplices){console.warn("Got keySplices, don't know what to do with them!")}detail.value.indexSplices.forEach(function(splice){var args=[path.join("."),splice.index,splice.removed.length];if(splice.addedCount){for(var i=splice.index,ii=splice.index+splice.addedCount;i<ii;i++){args.push(ctx._deepClone(splice.object[i]))}}ctx.splice.apply(ctx,args)})}else if(detail.path){path=path.concat(detail.path.split(".").slice(1));this.set(path,this._deepClone(detail.value))}else{this.splice("value",index,1,this._deepClone(detail.value))}},_removeArrayEl:function _removeArrayEl(el){var polyEl=Polymer.dom(el);if(babelHelpers.typeof(polyEl.childNodes[0])!=="undefined"){this.unlisten(polyEl.childNodes[0],polyEl.firstChild.schemaArrayItem.component.valueProperty.replace(/([A-Z])/g,"-$1").toLowerCase()+"-changed","_schemaArrayItemChanged");if(babelHelpers.typeof(polyEl.childNodes[1])!=="undefined"){this.unlisten(polyEl.childNodes[1],"tap","_onRemoveItem")}}el.schemaArrayItem=null;Polymer.dom(this.$.form).removeChild(el)},_clearForm:function _clearForm(){var formEl=Polymer.dom(this.$.form);while(formEl.firstChild){this._removeArrayEl(formEl.firstChild)}},_schemaChanged:function _schemaChanged(){this._clearForm();this._buildSchemaArrayItems();this._setValue()},_errorChanged:function _errorChanged(){var ctx=this;Polymer.dom(this.$.form).childNodes.forEach(function(rowEl,idx){if(ctx.error&&ctx.error[idx]){Polymer.dom(rowEl).childNodes[0].error=ctx.error[idx]}else{Polymer.dom(rowEl).childNodes[0].error=null}})},_onAddItemWithValue:function _onAddItemWithValue(values){var schema=this.schema.items;if(babelHelpers.typeof(values)!=="undefined"){for(var i in values){if(babelHelpers.typeof(schema.properties[i])!=="undefined"){schema.properties[i].value=values[i]}}}var item={label:schema.title,schema:schema,component:schema.component||{}};if(!item.component.valueProperty){item.component.valueProperty="value"}if(!item.component.name){if(this._isSchemaEnum(schema)){item.component.name="eco-json-schema-enum"}else if(this._isSchemaBoolean(schema.type)){item.component.name="eco-json-schema-boolean"}else if(this._isSchemaFile(schema.type)){item.component.name="eco-json-schema-file"}else if(this._isSchemaValue(schema.type)){item.component.name="eco-json-schema-input"}else if(this._isSchemaObject(schema.type)){item.component.name="eco-json-schema-object"}else if(this._isSchemaArray(schema.type)){item.component.name="eco-json-schema-array"}else{return console.error("Unknown item type %s",schema.type)}}var ctx=this,componentEl=ctx.create(item.component.name,{label:item.label,schema:item.schema,schemaArrayItem:item}),containerEl=ctx.create("paper-collapse-item",{header:"Item "+(i+1)}),buttonEl=ctx.create("paper-icon-button",{icon:"remove",title:"Remove item"});ctx.listen(buttonEl,"tap","_onRemoveItem");buttonEl.classList.add("array-remove-element");componentEl.classList.add("flex","horizontal","layout");Polymer.dom(containerEl).appendChild(componentEl);Polymer.dom(containerEl).appendChild(buttonEl);var beforeEl=ctx.$.form.children[i];if(beforeEl){Polymer.dom(ctx.$.form).insertBefore(containerEl,beforeEl)}else{Polymer.dom(ctx.$.form).appendChild(containerEl)}ctx.listen(componentEl,item.component.valueProperty.replace(/([A-Z])/g,"-$1").toLowerCase()+"-changed","_schemaArrayItemChanged");this._schemaArrayItems.push(item)},_onAddItem:function _onAddItem(){var schema=this.schema.items,item={label:schema.title,schema:schema,component:schema.component||{}};if(!item.component.valueProperty){item.component.valueProperty="value"}if(!item.component.name){if(this._isSchemaEnum(schema)){item.component.name="eco-json-schema-enum"}else if(this._isSchemaBoolean(schema.type)){item.component.name="eco-json-schema-boolean"}else if(this._isSchemaFile(schema.type)){item.component.name="eco-json-schema-file"}else if(this._isSchemaValue(schema.type)){item.component.name="eco-json-schema-input"}else if(this._isSchemaObject(schema.type)){item.component.name="eco-json-schema-object"}else if(this._isSchemaArray(schema.type)){item.component.name="eco-json-schema-array"}else{return console.error("Unknown item type %s",schema.type)}}this.push("_schemaArrayItems",item)},_onRemoveItem:function _onRemoveItem(e){var item=Polymer.dom(e).localTarget.previousSibling.schemaArrayItem,index=this._schemaArrayItems.indexOf(item);this.splice("_schemaArrayItems",index,1)},_deepClone:function _deepClone(o){return JSON.parse(JSON.stringify(o))},_isSchemaValue:function _isSchemaValue(type){return this._isSchemaBoolean(type)||this._isSchemaNumber(type)||this._isSchemaString(type)||this._isSchemaFile(type)},_isSchemaFile:function _isSchemaFile(type){if(Array.isArray(type)){return-1!==type.indexOf("file")}else{return"file"===type}},_isSchemaBoolean:function _isSchemaBoolean(type){if(Array.isArray(type)){return-1!==type.indexOf("boolean")}else{return"boolean"===type}},_isSchemaEnum:function _isSchemaEnum(schema){return!!schema.enum},_isSchemaNumber:function _isSchemaNumber(type){if(Array.isArray(type)){return-1!==type.indexOf("number")||-1!==type.indexOf("integer")}else{return"number"===type||"integer"===type}},_isSchemaString:function _isSchemaString(type){if(Array.isArray(type)){return-1!==type.indexOf("string")}else{return"string"===type}},_isSchemaObject:function _isSchemaObject(type){return"object"===type},_isSchemaArray:function _isSchemaArray(type){return"array"===type}});</script></dom-module></body></html>