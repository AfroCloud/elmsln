<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/hax-body/hax-source.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">
<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../elmsmedia-dashboard-filters/elmsmedia-dashboard-filters.html">

<dom-module id="elmsmedia-dashboard">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <app-location route="{{route}}"></app-location>
    <app-route route="{{route}}" pattern="/:page" data="{{data}}" tail="{{tail}}" query-params="{{queryParams}}"></app-route>

    <h3>Filter Media</h3>
    <elmsmedia-dashboard-filters media-type="{{queryParams.media_type}}" order="{{queryParams.order}}" on-filter-changed="_filterChanged"></elmsmedia-dashboard-filters>

    <hax-source auto request-end-point="[[requestEndPoint]]" request-params="{{queryParams}}" response-map='{
      "root": "list",
      "gizmoType": "video",
      "url": "http://media.elmsln.local/entity_iframe/node/",
      "id": "id",
      "title": "attributes.title",
      "description": "attributes.body",
      "image": "display.image",
      "customGizmoType": "type"}'></hax-source>
  </template>

  <script>
    Polymer({

      is: 'elmsmedia-dashboard',

      properties: {
        requestEndPoint: {
          type: String,
          value: ''
        },
        queryParams: {
          type: Object,
          value: {},
        }
      },
      _computeRequestEndPoint: function (endPoint, csrfToken) {
        return `${endPoint}/api/data?token=${csrfToken}`
      },
      /**
       * Listen for filter changes and reset the page count
       * @todo unsetting this object does not always work
       */
      _filterChanged: function (e) {
        this.set('queryParams.page', null);
        this.set('queryParams.page', undefined);
      }
    });
  </script>
</dom-module>